<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Finessed ASCII</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: monospace;
      font-size: 8px;
      line-height: 8px;
      white-space: pre;
      overflow: hidden;
    }
    #ascii {
      user-select: none;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <pre id="ascii"></pre>
  <canvas id="source" width="200" height="100" style="display: none;"></canvas>
  <script>
    const chars = "@#XOxo+:-. ";
    const ascii = document.getElementById("ascii");
    const canvas = document.getElementById("source");
    const ctx = canvas.getContext("2d");

    const img = new Image();
    img.src = "cell-bg.png";

    function getChar(brightness) {
      const idx = Math.floor(brightness / 255 * (chars.length - 1));
      return chars[idx];
    }

    img.onload = function () {
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      const baseData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

      let frame = 0;

      function render() {
        frame++;
        let asciiImage = "";
        for (let y = 0; y < canvas.height; y++) {
          for (let x = 0; x < canvas.width; x++) {
            const i = (y * canvas.width + x) * 4;
            const r = baseData[i];
            const g = baseData[i + 1];
            const b = baseData[i + 2];
            const brightness = 0.299 * r + 0.587 * g + 0.114 * b;

            // Animate upward using sine wave
            const wave = Math.sin((y - frame * 0.7) * 0.1 + x * 0.05) * 50;
            const char = getChar(Math.max(0, Math.min(255, brightness + wave)));
            asciiImage += char;
          }
          asciiImage += "\n";
        }
        ascii.textContent = asciiImage;
        requestAnimationFrame(render);
      }

      render();
    };
  </script>
</body>
</html>
